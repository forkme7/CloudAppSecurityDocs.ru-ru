---
title: "Настройка автоматической отправки журналов для непрерывных отчетов | Документы Майкрософт"
description: "В этом разделе приводятся сведения об отправке журналов для создания автоматических отчетов Cloud Discovery."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 10/15/2016
ms.topic: article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: c4123272-4111-4445-b6bd-2a1efd3e0c5c
ms.reviewer: reutam
ms.suite: ems
translationtype: Human Translation
ms.sourcegitcommit: ed4ea71b24767d3602d40894d1cbac7447bcd8a2
ms.openlocfilehash: 9672336d69f19875d160eb414bf3ca2c525692e1


---

# <a name="configure-automatic-log-upload-for-continuous-reports"></a>Настройка автоматической отправки журналов для непрерывных отчетов
Перед настройкой автоматического сбора файлов журнала проверьте, соответствует ли журнал требуемому типу. В противном случае службе Cloud App Security не удастся проанализировать файл. 

## <a name="technical-requirements"></a>Технические требования
- Низкоуровневая оболочка: HyperV или VMware
- Место на диске: 250 ГБ
- ЦП: 2
- ОЗУ: 4 ГБ 
- Параметры брандмауэра: 
- Разрешите сборщику журналируемых данных получать входящий трафик FTP и Syslog
- Разрешите сборщику журналируемых данных инициировать передачу исходящего трафика на портал (например, contoso.cloudappsecurity.com) через порт 443

  
## <a name="set-up-automatic-log-file-collection"></a>Настройка автоматического сбора файлов журнала  
  
Сборщики журналируемых данных позволяют легко автоматизировать отправку журналов из сети. Сборщик журналируемых данных выполняется в сети и получает журналы через Syslog или FTP. Каждый журнал автоматически обрабатывается, сжимается и передается на портал. Журналы FTP отправляются в Cloud App Security после завершения передачи файла по FTP в сборщик журналируемых данных. Для системных журналов сборщик журналируемых данных записывает полученные журналы на диск каждые 20 минут, а затем отправляет файл в Cloud App Security.  Виртуальная машина сборщика журналируемых данных доступна для Hyper-V (формат VHD) и для низкоуровневой оболочки VMware (формат OVF). Ей требуется 250 ГБ места на диске, 2 процессора и 4 ГБ ОЗУ. 
     
  
     The log collector VHD image can be downloaded and run on Azure servers.  
  
2.  Перейдите на страницу настройки автоматической отправки:  
    На портале Cloud App Security щелкните значок параметров ![значок параметров](./media/settings-icon.png "settings icon"), выберите пункт **Параметры Cloud Discovery**, а затем откройте вкладку **Отправлять журналы автоматически**.  
  
3.  Для каждого брандмауэра или прокси-сервера, с которого вы хотите отправить журналы, создайте соответствующий источник данных:  
  
    1.  Щелкните **Добавление источника данных**.  
  
    2.  Присвойте **Имя** прокси-серверу или брандмауэру.  
  
    3.  Выберите устройство в списке **Источник**.  
  
    4.  Сравните журнал с примером ожидаемого формата журнала. Если формат вашего файла журнала не соответствует этому примеру, необходимо добавить источник данных с параметром **Другой**.  
  
    5.  Задайте для параметра **Тип приемника** значение **FTP** или **Syslog**.  
  
         Для **Syslog** выберите **UDP** или **TCP**.  
  
    6.  Повторите эту процедуру для каждого брандмауэра и прокси-сервера, журналы которых можно использовать для обнаружения трафика в сети.  
  
4.  Перейдите на расположенную сверху вкладку **Сборщики данных журнала**.  
  
    1.  Щелкните **Добавить сборщик данных журнала**.  
  
    2.  Присвойте **имя** сборщику журналируемых данных.  
  
    3.  Выберите все **Источники данных**, которые необходимо подключить к сборщику, и нажмите кнопку **Обновить**.  
  
         > [!NOTE] 
       > Скопируйте содержимое экрана, так как эта информация потребуется при настройке взаимодействия сборщика журналируемых данных с Cloud App Security. Если вы выбрали системный журнал, эта информация будет включать сведения о порте, на котором будет работать прослушиватель системного журнала.
         
![источники данных обнаружения](./media/discovery-data-sources.png)
> [!NOTE] 
         > Отдельный сборщик журналируемых данных может обрабатывать несколько источников данных.
  
4.  **Загрузите** новую виртуальную машину сборщика журналируемых данных, щелкнув Hyper-V или VMWare, и распакуйте архив с помощью пароля, полученного на портале.  
  
## <a name="set-up-your-virtual-machine-in-hyperv"></a>Настройка виртуальной машины в Hyper-V:  
  
1.  Откройте диспетчер Hyper-V.  
  
2.  Выберите **Создать**, **Виртуальная машина** и нажмите кнопку **Далее**.  
  
             ![discovery hyperv virtual machine](./media/discovery-hyperv-virtual-machine.png "discovery hyperv virtual machine")  
  
3.  Укажите **Имя** новой виртуальной машины, например CloudAppSecurityLogCollector01.then, и нажмите кнопку **Далее**.  
  
4.  Выберите **Поколение 1** и нажмите кнопку **Далее**.  
  
5.  Измените значение **Память, выделяемая при запуске** на **4096 МБ**.  
        
6. Установите флажок **Use Dynamic Memory** (Использовать динамическую память) для этой виртуальной машины и нажмите кнопку **Далее**.  
  
7.  Если доступно, выберите сетевое **Подключение** и нажмите кнопку **Далее**.  
  
8.  Щелкните **Использовать имеющийся виртуальный жесткий диск** и выберите файл **VHD**, входящий в скачанный архив.  
  
9.  Нажмите кнопку **Далее** , а затем — кнопку **Готово**.  
  
             The machine will be added to your Hyper-V environment.  
  
9. Щелкните машину в таблице **Виртуальные машины** и нажмите кнопку **Запустить**.   
  
10. Подключитесь к виртуальной машине сборщика журналируемых данных, чтобы узнать, назначен ли ей DHCP-адрес. Для этого щелкните виртуальную машину и щелкните **Подключить**. Должен появиться запрос на вход. Если вы видите IP-адрес, значит, вы можете подключиться к виртуальной машине с помощью терминала или средства SSH.  Если вы не видите IP-адрес, выполните вход с помощью средств подключения Hyper-V или VMWare, используя учетные данные, скопированные при создании сборщика журналируемых данных. Вы можете сменить пароль и настроить виртуальную машину, выполнив приведенную ниже команду.
```
sudo network_config
```
> [!NOTE]
> Виртуальная машина предварительно настроена для получения IP-адреса от DHCP-сервера. Если необходимо настроить статические IP-адреса, шлюз по умолчанию, имя узла, DNS-серверы и NTPS, можно воспользоваться служебной программой **network_config** или внести изменения вручную.


На этом этапе сборщик журналируемых данных должен быть подключен к сети и иметь доступ к порталу Cloud App Security.  

## <a name="log-in-and-import"></a>Вход и импорт 
Чтобы войти в сборщик журналируемых данных в первый раз и импортировать его конфигурацию с портала, выполните указанные ниже действия. 

1.  Войдите в сборщик журналируемых данных по протоколу SSH с использованием учетных данных интерактивного администратора, предоставленных вам на портале. (Если вы входите в консоль впервые, вам необходимо сменить пароль и после этого выполнить вход еще раз. Если используется сеанс терминала, его может потребоваться перезапустить. )
2.  Запустите служебную программу настройки сборщика с токеном доступа, предоставленным при создании сборщика журналируемых данных. 

```
sudo collector_config <access token>
```

3. Введите домен консоли, например:

```
contoso.portal.cloudappsecurity.com
```

Он содержится в URL-адресе, который вы видите после входа на портал Cloud App Security. 
 

4. Введите имя сборщика журналируемых данных, который требуется настроить, например:

**CloudAppSecurityLogCollector01** или **NewYork** с приведенного выше рисунка.
 
8.  Импортируйте конфигурацию сборщика журналируемых данных с портала следующим образом:  
  
      1.  Войдите в сборщик журналируемых данных по протоколу SSH с использованием учетных данных интерактивного администратора, предоставленных вам на портале.  
  
       2.  Запустите служебную программу настройки сборщика с предоставленным токеном доступа с помощью команды **sudo collector_config \<токен доступа>**.  
  
             Введите домен консоли, например:  
  
             **contoso.portal.cloudappsecurity.com ** 
  
             Введите имя сборщика журналируемых данных, который требуется настроить, например:  
  
             **CloudAppSecurityLogCollector01**  
  
5.  Настройте сетевые брандмауэры и прокси-серверы для периодического экспорта журналов на выделенный порт Syslog FTP-каталога согласно указаниям в диалоговом окне, например:  
  
     `London Zscaler - Destination path: 614`  
  
     `SF Blue Coat - Destination path: \\CloudAppSecurityCollector01\BlueCoat\`  
  
6.  Чтобы убедиться, что журналы периодически отправляются на портал, воспользуйтесь журналом системы управления.  
  
## <a name="log-collector-performance"></a>Производительность сборщика журналируемых данных
Сборщик журналируемых данных может успешно обрабатывать до 50 ГБ журналов в час.

Основными узкими местами в процессе сбора журналов являются:
* Пропускная способность сети — определяет скорость отправки журналов.
* Производительность ввода-вывода виртуальной машины, назначенная ИТ-специалистом, — определяет скорость записи журналов на диск сборщика.

Сборщик журналируемых данных снабжен встроенным защитным механизмом, который контролирует скорость поступления журналов и сравнивает ее со скоростью передачи. В случае перегрузки сборщик начинает удалять файлы журнала. Если нагрузка, как обычно, превышает 50 ГБ в час, рекомендуется разделить трафик между несколькими сборщиками журналируемых данных.


<!--HONumber=Oct16_HO4-->


