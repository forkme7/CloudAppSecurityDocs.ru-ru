---
title: "Создание политик сеансов для получения полного представления о действиях сеансов пользователей и блокировки загрузок | Документация Майкрософт"
description: "В этом разделе описывается процедура настройки политики сеансов прокси-сервера Cloud App Security для получения полного представления о действиях сеансов пользователей и блокировки загрузок."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 10/31/2017
ms.topic: article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: 745df28a-654c-4abf-9c90-203841169f90
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: 97ebb7db49fcf5ed524a05943557d616487294f8
ms.sourcegitcommit: 3bc510959e66a29d474cbef412deac0daefa8a24
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2017
---
# <a name="session-policies"></a>Политики сеансов 

> [!NOTE]
> Начато развертывание компонента прокси-сервера Microsoft Cloud App Security.

Политики сеансов Cloud App Security управляют мониторингом в режиме реального времени на уровне сеанса, обеспечивая детализированный контроль над облачными приложениями и давая возможность предпринимать различные действия в соответствии с настроенной для сеанса пользователя политикой. Вместо того чтобы полностью разрешить или блокировать доступ, управление сеансом позволяет обеспечить доступ в режиме мониторинга сеанса и при необходимости ограничить действия в рамках определенного сеанса. 

Например, неуправляемым устройствам или сеансам из определенных расположений можно разрешить доступ к приложению, но при этом ограничить скачивание конфиденциальных файлов или обеспечить защиту отдельных документов от скачивания. Такие возможности управления сеансом пользователя можно реализовать с помощью политик сеансов. 

## <a name="prerequisites-to-using-session-policies"></a>Предварительные требования для использования политик сеансов

- Лицензия Azure Active Directory Premium P2
- Развертывание соответствующих [приложений с прокси-сервером](proxy-deployment-aad.md)
- Необходимо реализовать [политику условного доступа Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal), которая задает перенаправление пользователей на прокси-сервер Cloud App Security, как описывается ниже.


## <a name="create-an-azure-ad-conditional-access-policy"></a>Создание политики условного доступа Azure Active Directory

Политики условного доступа Azure Active Directory и политики сеансов Cloud App Security применяются совместно, обеспечивая проверку сеанса пользователя и принятие решений в соответствии с политикой для каждого приложения. Чтобы настроить политику условного доступа в Azure Active Directory, выполните следующие действия:

1. Настройте [политику условного доступа Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal), назначив пользователя или группу пользователей и приложение SAML, которыми требуется управлять с помощью прокси-сервера Cloud App Security. 

  > [!NOTE]
  > Эта политика применяется только к приложениям, [развернутым с прокси-сервером](proxy-deployment-aad.md).

2. Реализуйте перенаправление пользователей на прокси-сервер Cloud App Security, выбрав параметр **Использовать ограничения, применяемые прокси-сервером**, в колонке **Сеанс**.

 ![Ограничения, применяемые прокси-сервером к условному доступу Azure Active Directory](./media/proxy-deploy-restrictions-aad.png)

## <a name="create-a-cloud-app-security-session-policy"></a>Создание политики сеансов Cloud App Security 

Чтобы создать политику сеанса, выполните следующую процедуру.

1. На портале последовательно выберите **Управление** и затем **Политики**.
3. На странице **Политики** щелкните **Создать политику** и выберите **Политика сеанса**.  

 ![Создание политики сеанса](./media/create-session-policy.png)

4. В окне **Политика сеанса** присвойте создаваемой политике имя, например *Блокировка скачивания конфиденциальных документов в Box для пользователей маркетингового отдела*.

 ![Новая политика сеанса](./media/new-session-policy.png)

5. В поле **Тип управления сеансом**: 

    1. Выберите **Отслеживать все действия**, если требуется отслеживать только действия пользователей.

    2. Выберите **Отслеживать все действия и контролировать скачивание файлов**, чтобы отслеживать действия пользователя и выполнять дополнительные операции, например блокировать или защищать функции скачивания для пользователей.

    ![Тип управления политики сеанса](./media/session-policy-control-type.png)

6. В области **Источник действия** в разделе **Действия, соответствующие всем следующим условиям**, примените к политике дополнительные фильтры действий. Можно выбрать следующие варианты: 

     - **Теги устройств**. Этот фильтр используется для идентификации неуправляемых устройств.

     - **Расположение**. Этот фильтр используется для идентификации неизвестных (и, соответственно, сопряженных с риском) расположений. 

     - **IP-адрес**. Этот вариант позволяет выполнять фильтрацию по IP-адресам или использовать ранее назначенные теги IP-адресов. 

     - **Тег агента пользователя**. Этот фильтр позволяет использовать эвристические алгоритмы для идентификации мобильных и классических приложений. Этот фильтр может быть равен или не равен **Native client** и должен проверяться для мобильных и классических приложений для каждого облачного приложения.
         
         ![Поддержка Native Client](./media/user-agent-tag.png)

       >[!NOTE]
       >Политики сеансов не поддерживают мобильные и классические приложения. Предварительно проверьте политики сеансов и убедитесь, что они не мешают работе мобильных или классических приложений. При необходимости исключите мобильные и настольные приложения из политик сеансов.

     ![Источник действий политики сеанса](./media/session-policy-activity-filters.png)

7. Если выбран параметр **Отслеживать все действия и контролировать скачивание файлов**:

    1. В области **Источник действия** в разделе **Файлы, соответствующие всем следующим условиям** примените к политике дополнительные фильтры файлов. Можно выбрать следующие варианты:

        - **Метка классификации**. Этот фильтр задается в том случае, если в вашей организации используется решение Azure Information Protection и реализуется защита данных с помощью его меток классификации. В этом случае вы сможете отфильтровать файлы по назначенным им меткам классификации. Дополнительные сведения об интеграции между Cloud App Security и Azure Information Protection см. в разделе [Интеграция с Azure Information Protection](azip-integration.md).

        - **Имя файла**. Этот фильтр позволяет применить политику к конкретным файлам.

        - **Тип файла**. Этот тип позволяет применить политику к определенным типам файлов, например заблокировать скачивание любых XLS-файлов.

         ![Фильтры файлов политики сеанса](./media/session-policy-file-filters.png)

        
    2. В разделе **Проверка содержимого** укажите, требуется ли включить модуль защиты от потери данных для сканирования документов и содержимого файлов.
 
     ![Проверка содержимого политики сеанса](./media/session-policy-content-inspection.png)

    3. В разделе **Действия** выберите один из следующих вариантов: 

        - **Разрешить**. Установите это действие, чтобы явно разрешить скачивание в соответствии с установленными фильтрами политики.

        - **Блокировать**. Установите это действие, чтобы явно заблокировать скачивание в соответствии с установленными фильтрами политики. Дополнительные сведения см. в разделе [Как реализуется блокировка скачивания](#block-download).

        - **Защитить**. Если в вашей организации используется решение Azure Information Protection, задайте **Действие**, чтобы применить к файлу метку классификации, установленную в Azure Information Protection. Дополнительные сведения см. в разделе [Как реализуется защита от скачивания](#protect-download).

         ![Действия политики сеанса](./media/session-policy-actions.png)

10. Вы можете установить флажок **Создать оповещение для каждого соответствующего события с уровнем серьезности политики**, задать ограничения для оповещений и настроить их отправку по электронной почте, в текстовых сообщениях или обоими способами.

    ![Оповещение политики сеанса](./media/session-policy-alert.png)


## <a name="how-session-monitoring-works"></a>Как работает мониторинг сеансов

При создании политики сеанса каждый соответствующий ей сеанс пользователя перенаправляется не напрямую в приложение, а в систему управления сеансами прокси-сервера. При этом пользователь увидит соответствующее уведомление о том, что осуществляется мониторинг сеансов.

   ![Уведомление о мониторинге сеансов](./media/session-monitoring-notice.png)

Если отображать уведомление о мониторинге не требуется, эту функцию можно отключить.

1. Щелкните значок шестеренки и выберите **Общие параметры**. 

2. Перейдите в раздел параметров прокси-сервера Cloud App Security и снимите флажок **Уведомить пользователей**.

    ![Отключение уведомления о мониторинге сеанса](./media/disable-session-monitoring-notice.png)

Чтобы пользователь не выходил из сеанса, прокси-сервер заменяет все соответствующие URL-адреса, сценарии Java и файлы cookie в приложении на URL-адреса прокси-сервера. Например, если приложение возвращает страницу со ссылками, домены которых заканчиваются на myapp.com, прокси-сервер заменяет их ссылками с доменами, оканчивающимися на myapp.com.us.cas.ms или другой суффикс. Таким образом реализуется мониторинг всего сеанса прокси-сервером.

Прокси-сервер ведет журналы трафика для каждого сеанса пользователя, который проходит через него. В журналах трафика регистрируются время, IP-адрес, агент пользователя, посещенные URL-адреса, а также объем скачанных и загруженных данных. Эти журналы анализируются, а в список отчетов Cloud Discovery в панели мониторинга Cloud Discovery добавляется непрерывный отчет **Прокси-сервер Cloud App Security**.

![Отчет прокси-сервера](./media/proxy-report.png)


Чтобы экспортировать эти журналы, выполните следующие действия:

1. Щелкните значок шестеренки и перейдите в раздел **Прокси-сервер**.
2. В правой части таблицы нажмите кнопку экспорта ![Кнопка экспорта](./media/export-button.png). 
3. Укажите диапазон отчета и щелкните **Экспорт**. Этот процесс может занять некоторое время.

Чтобы скачать экспортированный журнал, выполните следующие действия:

1. После того как отчет создан, перейдите в раздел **Сведения** и выберите **Настраиваемые отчеты**.
2. В таблице выберите нужный отчет в списке **Журналы трафика прокси-сервера** и нажмите кнопку скачивания ![Кнопка скачивания](./media/download-button.png). 


## Как реализуется блокировка скачивания <a name="block-download"></a>

Если выбран параметр **Блокировать** в разделе **Действие**, которое будет предприниматься политикой сеанса прокси-сервера Cloud App Security, прокси-сервер запрещает пользователю скачивать файлы в соответствии с установленными в политике фильтрами файлов. Прокси-сервер распознает событие скачивания для каждого приложения SAML и, как только это событие инициируется пользователем, в реальном времени блокирует его выполнение. При получении сигнала о том, что пользователь инициировал скачивание, прокси-сервер возвращает пользователю сообщение **Скачивание ограничено** и заменяет скачанный файл текстовым файлом, который может содержать сообщение для пользователя, настраиваемое в политике сеанса прокси-сервера.  

## Как реализуется защита от скачивания <a name="protect-download"></a>

Если выбран параметр **Защитить** в разделе **Действие**, которое будет предприниматься политикой сеанса прокси-сервера Cloud App Security, прокси-сервер принудительно применяет метки и последующие способы защиты файла в соответствии с установленными в политике фильтрами файлов. Метки настраиваются в консоли Azure Information Protection в Azure. Чтобы метка отображалась среди доступных вариантов в политике Cloud App Security, необходимо выбрать параметр **Защитить**. Если выбрана метка, а скачиваемый файл соответствует условиям политики Cloud App Security, эта метка и соответствующий уровень защиты (с разрешениями) применяются к файлу при скачивании. Исходный файл остается в облачном приложении без изменений, а скачанный файл после этого будет защищен. Чтобы получить доступ к этому файлу, пользователям потребуются разрешения, которые определяются примененным уровнем защиты.  
 
  
## <a name="see-also"></a>См. также  
[Блокировка скачивания на неуправляемых устройствах с помощью функций прокси-сервера Azure Active Directory](use-case-proxy-block-session-aad.md)   
[Получить техническую поддержку можно на странице службы технической поддержки Cloud App Security.](http://support.microsoft.com/oas/default.aspx?prid=16031)   
[Клиенты с поддержкой Premier также могут выбрать Cloud App Security непосредственно на портале Premier.](https://premier.microsoft.com/)  
  
  