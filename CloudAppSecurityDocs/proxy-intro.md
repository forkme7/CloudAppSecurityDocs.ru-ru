---
title: "Работа с прокси-сервером Cloud App Security | Документация Майкрософт"
description: "В этой статье объясняется, как работает прокси-сервер Cloud App Security."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 8/9/2017
ms.topic: article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: 28317b70-1851-4610-b1d6-863bc5994bb6
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: d4b01d92f705566bac36d764a7aede0eaa8defcc
ms.sourcegitcommit: 4cf65f627f2d370ee4a4decae1acbb9658874056
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/13/2017
---
# <a name="working-with-the-cloud-app-security-proxy"></a>Работа с прокси-сервером Cloud App Security

Для современных организаций часто недостаточно узнавать о событиях в облачной среде постфактум. Организациям необходимо предотвращать бреши и утечки в реальном времени, прежде чем сотрудники осознанно или невольно подвергнут риску данные и все предприятие. У корпоративных пользователей должна быть возможность максимально эффективно задействовать большинство служб и средств в облачных приложениях, а также использовать на работе личные устройства. В то же время организациям нужны средства, способствующие защите от утечки информации, атак программ-шантажистов и кражи больших объемов данных. 

## <a name="introducing-the-cloud-app-security-proxy"></a>Общие сведения о прокси-сервере Cloud App Security
Прокси-сервер Cloud App Security предоставляет средства, с помощью которых можно в реальном времени отслеживать и контролировать доступ к облачной среде, а также выполняемые в ней действия.
Прокси-сервер Cloud App Security обеспечивает следующие способы защиты организации:
- предотвращение утечки данных посредством упреждающей блокировки скачивания файлов;
- минимизация угроз программ-шантажистов посредством контроля и блокировки доступа к сети для неуправляемых устройств, которые не защищены паролем или на которых нет антивирусного программного обеспечения;
- настройка правил принудительного шифрования данных, хранящихся в облаке или скачиваемых из него;
- получение информации о незащищенных конечных точках для отслеживания действий на неуправляемых устройствах;
- контроль доступа из рискованных IP-адресов и устаревших поставщиков удостоверений.

Чтобы получить эти уникальные возможности, используйте два уровня управления на прокси-сервере: контроль доступа и управление сеансом. Для каждого типа управления требуются сведения о пользователе, расположении и устройстве (для определения управляемых и неуправляемых устройств), что позволяет принимать решения на основе политик для каждого приложения.

## <a name="access-control"></a>Контроль доступа
Контроль доступа предоставляет возможности мониторинга, аудита и блокировки доступа в зависимости от приложения, устройства, пользователей и расположения. Таким образом можно в режиме реального времени контролировать доступ к облачным приложениям.

Контроль доступа позволяет создавать мощные политики, такие как:
 - блокировка доступа к облачным приложениям с неуправляемых устройств;
 - блокировка доступа конкретных пользователей к определенным облачным приложениям;
 - отслеживание доступа к определенным облачным приложениям из конкретных расположений;
 - ограничение доступа к облачным приложениям для конкретных групп пользователей и расположений.

Чтобы использовать контроль доступа в Cloud App Security, разверните прокси-сервер, внесите несколько изменений в существующую конфигурацию поставщика удостоверений и настройте политику для управления облачными приложениями. 

> [!NOTE]
> -  Изменять существующие политики поставщика удостоверений не нужно.

### <a name="how-access-control-works"></a>Как работает контроль доступа

При развертывании прокси-сервера необходимо изменить конфигурации поставщика удостоверений и приложения для перенаправления запросов на вход на прокси-сервер. 

После этого все события входа в систему проходят через прокси-сервер, который определяет, что нужно сделать: разрешить доступ к приложению, отказать в доступе или предоставить доступ, но с отслеживанием сеанса.

### <a name="supported-apps-and-identity-providers"></a>Поддерживаемые приложения и поставщики удостоверений

Контроль доступа предназначен для работы с любыми приложениями и поставщиками удостоверений, поддерживающими протокол SAML или WS-Federation. Разработчики Cloud App Security проверили ведущие приложения и поставщики удостоверений с использованием возможностей контроля доступа. Но так как существует много поставщиков удостоверений и облачных приложений, прежде чем развертывать единый вход в рабочей среде, мы рекомендуем проверить его для конкретного поставщика удостоверений и приложения в песочнице или среде тестирования.

## <a name="session-control"></a>Управление сеансом

Управление сеансом представляет собой дополнительный уровень контроля, предоставляя подробные сведения о каждом действии в каждом сеансе пользователя. Управление сеансом позволяет вести более глубокое отслеживание на уровне сеанса и дает детализированное представление о работе облачных приложений (на встроенных прокси-серверах для локальных приложений). Вместо разрешения и блокировки доступа полностью управление сеансом позволяет ограничить действия определенного сеанса. 

Например, неуправляемым устройствам или сеансам из определенных расположений можно разрешить доступ к приложению, но при этом ограничить скачивание конфиденциальных файлов. 

### <a name="how-session-control-works"></a>Как работает управление сеансом

Управление сеансом на прокси-сервере основано на контроле доступа. Когда вы управляете доступом к приложению, можно задать политики сеансов, которые будут перенаправлять сеансы пользователей на прокси-сервер, который будет ими управлять. После этого запросы и ответы пользователя передаются через прокси-сервер, а не прямо в приложение.

Чтобы пользователь не выходил из сеанса, прокси-сервер заменяет все соответствующие URL-адреса, сценарии Java и файлы cookie в приложении на страницы, продублированные на прокси-сервере. Например, если приложение возвращает страницу со ссылками, которые заканчиваются на *myapp.com*, прокси-сервер заменяет их на страницы с примерно таким окончанием: *myapp.com.cas.ms*.

Когда сеанс направляется через прокси-сервер, прокси-сервер может проверять трафик, выводить данные о событиях, обнаруженных на портале прокси-сервера Cloud App Security, и принудительно применять к сеансу те или иные политики.

## <a name="device-identification"></a>Идентификация устройств

Cloud App Security позволяет определять и создавать политики прокси-сервера на основе состояния устройства. Чтобы определить, является ли устройство управляемым, Cloud App Security использует следующие компоненты.
 - Совместимые устройства Intune * 
 - Устройства, присоединенные к домену Azure AD * 
 - Развертывание сертификатов клиентов (для всех приложений)

* Доступно только для приложений Azure AD, где поддерживается условный доступ.

## <a name="architecture"></a>Архитектура

Azure Active Directory упрощает интеграцию с возможностями прокси-сервера. Вы также можете использовать устройства, присоединенные к домену Azure AD, и совместимые устройства Intune для быстрой идентификации устройств в процессе создания политики. 

Чтобы задать другие поставщики удостоверений и приложения для работы с прокси-сервером, их необходимо настроить для перенаправления на прокси-сервер всех запросов на вход.

Кроме того, для определения управляемых устройств прокси-сервер может запрашивать сертификаты клиентов на управляемых устройствах. Если прокси-сервер получил сертификат клиента, устройство считается управляемым и политики управляемых и неуправляемых устройств вступают в силу.

Дополнительные сведения о процессе развертывания см. в статье [Развертывание прокси-сервера](proxy-deployment.md).

![Архитектура прокси-сервера Cloud App Security](./media/proxy-architecture.png)

## <a name="user-login-flow"></a>Последовательность операций входа пользователя

1. Пользователь отправляет запрос в поставщик удостоверений и предоставляет учетные данные.
2.  Если доступ разрешен, поставщик удостоверений перенаправляет пользователя на прокси-сервер Cloud App Security.
3.  При наличии установленного сертификата клиента и политики для определения управляемых и неуправляемых устройств отображается запрос на предоставление сертификатов клиентов. В любом случае выполняется оценка политики доступа.
4.   На этом этапе возможны 3 сценария:
    -   Пользователю разрешается доступ к приложению.
    -   Доступ пользователя к приложению блокируется.
    -   Пользователю разрешается доступ к приложению, но сеанс будет отслеживаться.
        -   В этом случае пользователь снова перенаправляется на прокси-сервер Cloud App Security, который отслеживает весь сеанс взаимодействия пользователя с приложением. Во время отслеживания прокси-сервер оценивает политики сеансов и по мере необходимости может блокировать те или иные действия.

>[!NOTE]
> На приведенной выше схеме показан *вход, инициируемый поставщиком удостоверений*. Если пользователь начинает работу из приложения (*вход, инициируемый поставщиком услуг*), он перенаправляется на прокси-сервер Cloud App Security, а затем — на поставщика удостоверений. Дальше последовательность операций входа такая же, как при *входе, инициируемом поставщиком удостоверений*.

## <a name="managed-devices-flow"></a>Схема использования управляемых устройств

Чтобы определить управляемые устройства, не управляемые Azure AD, прокси-сервер использует механизм сертификатов клиентов. Этот механизм работает следующим образом:

1. Если пользователь установил сертификат клиента на устройстве и существует политика, которая проверяет наличие управляемых и неуправляемых устройств, происходит следующее.
   -   Если на этапе входа пользователь переходит на страницу прокси-сервера, прокси-сервер запрашивает сертификат клиента на устройстве.

   -   На устройстве отображается запрос на предоставление сертификата клиента. Если пользователь подтверждает запрос, сертификат клиента отправляется на прокси-сервер.

   -   Затем прокси-сервер выполняет проверку подлинности сертификата клиента относительно корневого сертификата, предоставленного администратором.

   -   Если сертификат клиента проходит проверку подлинности относительно корневого сертификата, устройство считается управляемым.

-   Если любой из предыдущих этапов не выполнен, устройство считается неуправляемым.



## <a name="see-also"></a>См. также  
[Развертывание прокси-сервера Cloud App Security](proxy-deployment.md)   
[Для получения технической поддержки посетите страницу службы технической поддержки Cloud App Security.](http://support.microsoft.com/oas/default.aspx?prid=16031)   
[Клиенты с поддержкой Premier также могут выбрать Cloud App Security непосредственно на портале Premier.](https://premier.microsoft.com/)  
  