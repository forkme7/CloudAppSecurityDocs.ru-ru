---
title: "Работа с прокси-сервером Cloud App Security | Документация Майкрософт"
description: "В этой статье объясняется, как работает прокси-сервер Cloud App Security."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 7/31/2017
ms.topic: article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: 28317b70-1851-4610-b1d6-863bc5994bb6
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: 82e1ee0b5161dce88db815dc8eea06340bdbc532
ms.sourcegitcommit: f9851779aa15b11f559e56ac818f1333f027c000
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="working-with-the-cloud-app-security-proxy"></a>Работа с прокси-сервером Cloud App Security

Для современных организаций часто недостаточно узнавать о событиях в облачной среде постфактум. Организациям необходимо предотвращать бреши и утечки в реальном времени, прежде чем сотрудники осознанно или невольно подвергнут риску данные и все предприятие. У корпоративных пользователей должна быть возможность максимально эффективно задействовать большинство служб и средств в облачных приложениях, а также использовать на работе личные устройства. В то же время организациям нужны средства, способствующие защите от утечки информации, атак программ-шантажистов и кражи больших объемов данных. 

## <a name="introducing-the-cloud-app-security-proxy"></a>Общие сведения о прокси-сервере Cloud App Security
Прокси-сервер Cloud App Security предоставляет средства, с помощью которых можно в реальном времени отслеживать и контролировать доступ к облачной среде, а также выполняемые в ней действия.
Прокси-сервер Cloud App Security обеспечивает следующие способы защиты организации:
- предотвращение утечки данных посредством упреждающей блокировки скачивания файлов;
- минимизация угроз программ-шантажистов посредством контроля и блокировки доступа к сети для неуправляемых устройств, которые не защищены паролем или на которых нет антивирусного программного обеспечения;
- настройка правил принудительного шифрования данных, хранящихся в облаке или скачиваемых из него;
- получение информации о незащищенных конечных точках для отслеживания действий на неуправляемых устройствах;
- контроль доступа из рискованных IP-адресов и устаревших поставщиков удостоверений.

Чтобы получить эти уникальные возможности, используйте два уровня управления на прокси-сервере: контроль доступа и управление сеансом. Для каждого типа управления требуются сведения о пользователе, расположении и устройстве (для определения управляемых и неуправляемых устройств), что позволяет принимать решения на основе политик для каждого приложения.

### <a name="access-control"></a>Контроль доступа
<more information about what is access control including examples> Контроль доступа на прокси-сервере позволяет создавать высокоэффективные политики доступа для облачных приложений и обеспечивает указанные ниже возможности.

Чтобы использовать контроль доступа в Cloud App Security, разверните прокси-сервер, внесите несколько изменений в существующую конфигурацию поставщика удостоверений и настройте политику для управления облачными приложениями. 

> [!NOTE]
> -  Изменять существующие политики поставщика удостоверений не нужно.

#### <a name="supported-apps-and-identity-providers"></a>Поддерживаемые приложения и поставщики удостоверений

Контроль доступа на прокси-сервере предназначен для работы с любыми приложениями и поставщиками удостоверений, поддерживающими протокол SAML или WS-Federation. Разработчики Cloud App Security проверяют ведущие приложения и поставщики удостоверений, используя возможности контроля доступа. Но так как существует много поставщиков удостоверений и облачных приложений, не все их сочетания возможно проверить. Прежде чем развертывать единый вход в рабочей среде, мы рекомендуем проверить его для конкретного поставщика удостоверений и приложения в песочнице или среде тестирования.

### <a name="session-control"></a>Управление сеансом

Управление сеансом представляет собой дополнительный уровень контроля на прокси-сервере. Эта функция обеспечивает более широкие возможности контроля над облачными приложениями в реальном времени. Вместо настройки общей политики для разрешения или блокировки доступа к определенному приложению вы можете разрешить доступ, а затем, отслеживая каждый сеанс пользователя в приложении, ограничивать доступ различными способами. Например, определенным устройствам или сеансам из определенных расположений можно разрешить доступ к приложению, но при этом ограничить скачивание конфиденциальных файлов.

#### <a name="supported-apps-and-flows"></a>Поддерживаемые приложения и последовательности

Сейчас функция управления сеансом позволяет блокировать скачивание файлов и экспорт отчетов в Salesforce.com. Политики можно создавать на основе данных о пользователе, расположении и устройстве, а также на основе скачиваемого содержимого.

Кроме того, в этой версии поддерживаются сеансы ограниченного доступа для пользователей, работающих в браузере. Например, чтобы ограничить доступ для сеансов из собственных приложений, необходимо настроить в политике блокировку доступа, если значение фильтра **Тег агента пользователя** равно **Собственный клиент**.

Salesforce проверяется во всех стандартных последовательностях. Но так как для Salesforce существует много сторонних приложений, вероятно, некоторые из них не были протестированы и могут не работать с функцией управления сеансом или даже вызывать ошибку при работе с некоторыми страницами. Чтобы убедиться, что проблема действительно вызвана сторонним приложением, удалите все сторонние приложения и проверьте работу приложения при управлении сеансом. Если все работает должным образом, добавляйте сторонние приложения по одному, пока не определите проблемный продукт. 

## <a name="device-management"></a>Управление устройствами

Cloud App Security позволяет определять и создавать политики прокси-сервера на основе состояния устройства. Чтобы определить, является ли устройство управляемым, в Cloud App Security используется механизм сертификатов клиентов, который позволяет развертывать сертификаты клиентов на управляемых устройствах в вашей организации. Когда пользователь входит в приложение, отображается запрос на предоставление установленного на устройстве сертификата клиента. Если пользователь предоставляет сертификат, Cloud App Security считает устройство управляемым. 
> [!NOTE]
>  Если пользователь отклоняет запрос, устройство считается неуправляемым.
<Допустим, мы узнали, что устройство управляется или не управляется. Что же происходит после этого?>

### <a name="supported-browsers-and-native-apps"></a>Поддерживаемые браузеры и собственные приложения

Прокси-сервер Cloud App Security позволяет... на основе сертификатов клиента.

Сертификаты клиентов — это хорошо известный механизм, который разработчики браузеров и собственных приложений могут использовать на свое усмотрение. Большинство браузеров на большинстве платформ поддерживают этот механизм, но с собственными приложениями все гораздо сложнее.

Сертификаты клиентов в собственных приложениях, включая классические и мобильные приложения, могут поддерживаться по-разному в зависимости от платформы и даже состояния устройства. Например, в Salesforce1 (мобильное приложение Salesforce) сертификаты клиентов будут поддерживаться, только если на устройстве развернуто управление мобильными устройствами (MDM), а в приложении Salesforce1 настроена отправка сертификатов клиентов.

Сертификаты клиентов успешно протестированы в браузерах Internet Explorer, Edge, Chrome, Safari и Firefox в последних версиях Windows, OSX, Android и iOS (каждая ОС с соответствующим браузером).

> [!NOTE]
> В iOS сертификаты клиентов поддерживает только браузер Safari.

Даже если браузер или собственное приложение поддерживают сертификаты клиентов, у пользователей могут возникнуть проблемы при предоставлении сертификата. Например, если один раз пользователь отклонит запрос на предоставление сертификата клиента, браузер или собственное приложение может запомнить этот выбор и не запросить сертификат в следующий раз. В этом случае мы рекомендуем либо закрыть все экземпляры браузера, открыть новые и повторить попытку, либо очистить все файлы cookie и повторить попытку.

В то же время существуют браузеры и собственные приложения, которые поддерживают блокировку всплывающих окон с запросом сертификатов клиентов и вместо этого отправляют сертификаты автоматически.

В целом мы рекомендуем проверять запросы на предоставление пользователями сертификатов клиентов без принудительного применения политик и только в режиме мониторинга. Это можно сделать, создав политику **Только журнал**, которая будет определять управляемые устройства.

## <a name="architecture"></a>Архитектура

Прокси-сервер интегрируется как с поставщиком удостоверений, так и с приложением, и в обоих компонентах необходимо настроить перенаправление на прокси-сервер всех запросов на вход.

Кроме того, для определения управляемых устройств прокси-сервер может запрашивать сертификаты клиентов на управляемых устройствах. Если прокси-сервер получил сертификат клиента, устройство считается управляемым и политики управляемых и неуправляемых устройств вступают в силу.

Дополнительные сведения о процессе развертывания см. в статье "Развертывание прокси-сервера Cloud App Security".

![Архитектура прокси-сервера Cloud App Security](./media/proxy-architecture.png)

## <a name="user-login-flow"></a>Последовательность операций входа пользователя

На схеме выше показан процесс входа, который начинается у поставщика удостоверений (также называется *входом, инициируемым поставщиком удостоверений*). Если пользователь начинает работу из приложения (*вход, инициируемый поставщиком услуг*), он перенаправляется на прокси-сервер Cloud App Security, который в свою очередь перенаправляет пользователя на поставщика удостоверений. Дальше последовательность операций входа такая же, как при *входе, инициируемом поставщиком удостоверений*.

*Вход, инициируемый поставщиком удостоверений*, выглядит так:
-   Пользователь отправляет запрос в поставщик удостоверений и предоставляет учетные данные.

-   Если доступ разрешен, поставщик удостоверений перенаправляет пользователя на прокси-сервер Cloud App Security.

-   При наличии установленного сертификата клиента и политики для определения управляемых и неуправляемых устройств отображается запрос на предоставление сертификатов клиентов. В любом случае выполняется оценка политики доступа.

-   На этом этапе возможны 3 сценария:

    -   Пользователю разрешается доступ к приложению.

    -   Доступ пользователя к приложению блокируется.

    -   Пользователю разрешается доступ к приложению, но сеанс будет отслеживаться.

        -   В этом случае пользователь снова перенаправляется на прокси-сервер Cloud App Security, который отслеживает весь сеанс взаимодействия пользователя с приложением.

        -   Во время отслеживания прокси-сервер оценивает политики сеансов и по мере необходимости может блокировать те или иные действия.

## <a name="how-access-control-works"></a>Как работает контроль доступа

При развертывании прокси-сервера необходимо изменить конфигурации поставщика удостоверений и приложения, доступ к которому вы хотите контролировать. В частности, в конфигурациях нужно изменить URL-адреса, которые поставщик удостоверений и приложение используют для перенаправления на прокси-сервер всех запросов на вход. Кроме того, при необходимости нужно заменить и сертификаты.

Если эти шаги выполнены, все события входа проходят через прокси-сервер, который определяет, что нужно сделать: разрешить доступ к приложению, отказать в доступе или предоставить доступ, но с отслеживанием сеанса. Обратите внимание, что на этом этапе прокси-сервер может запросить сертификаты клиента с устройства и использовать состояние устройства для принятия решений на основе политик.

## <a name="how-session-control-works"></a>Как работает управление сеансом

Управление сеансом на прокси-сервере основано на контроле доступа. Когда вы управляете доступом к приложению, вы можете на основании политик доступа отслеживать сеанс, перенаправляя сеансы на прокси-сервер, который будет ими управлять. После этого запросы и ответы пользователя передаются через прокси-сервер, а не прямо в приложение.

Чтобы пользователь не выходил из сеанса, прокси-сервер заменяет все соответствующие URL-адреса, сценарии Java и файлы cookie в приложении на страницы, продублированные на прокси-сервере. Например, если приложение возвращает страницу со ссылками, которые заканчиваются на *myapp.com*, прокси-сервер заменяет их на страницы с примерно таким окончанием: *myapp.com.cas.ms*.

Когда сеанс направляется через прокси-сервер, прокси-сервер может проверять трафик, выводить данные о событиях, обнаруженных на портале прокси-сервера Cloud App Security, и принудительно применять к сеансу те или иные политики.

## <a name="how-identifying-managed-devices-works"></a>Как работает определение управляемых устройств

Чтобы определить управляемые устройства, прокси-сервер использует механизм сертификатов клиентов. Этот механизм работает следующим образом:

-   Если пользователь установил сертификат клиента на устройстве, и существует политика, которая проверяет наличие управляемых и неуправляемых устройств, происходит следующее:

    -   Если на этапе входа пользователь переходит на страницу прокси-сервера, прокси-сервер запрашивает сертификат клиента на устройстве.

    -   На устройстве отображается запрос на предоставление сертификата клиента. Если пользователь подтверждает запрос, сертификат клиента отправляется на прокси-сервер.

    -   Затем прокси-сервер выполняет проверку подлинности сертификата клиента относительно корневого сертификата, предоставленного администратором.

    -   Если сертификат клиента проходит проверку подлинности относительно корневого сертификата, устройство считается управляемым.

-   Если любой из предыдущих этапов не выполнен, устройство считается неуправляемым.



## <a name="see-also"></a>См. также  
[Развертывание прокси-сервера Cloud App Security](proxy-deployment.md)   
[Для получения технической поддержки посетите страницу службы технической поддержки Cloud App Security.](http://support.microsoft.com/oas/default.aspx?prid=16031)   
[Клиенты с поддержкой Premier также могут выбрать Cloud App Security непосредственно на портале Premier.](https://premier.microsoft.com/)  
  