---
title: "Настройка автоматической отправки журналов для непрерывных отчетов | Документы Майкрософт"
description: "В этом разделе описывается процесс настройки автоматической отправки журналов для непрерывных отчетов в Cloud App Security с помощью Docker в Ubuntu."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 7/16/2017
ms.topic: get-started-article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: cc29a6cb-1c03-4148-8afd-3ad47003a1e3
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: e32eebc75355e8016fcdb62a1b113431db346c31
ms.sourcegitcommit: ae4c8226f6037c5eb286eb27142d6bbb397609e9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/16/2017
---
# <a name="set-up-and-configuration-on-ubuntu"></a>Настройка и конфигурация в Ubuntu

## <a name="technical-requirements"></a>Технические требования

-   ОС: Ubuntu 14.04 или более поздняя версия

-   Место на диске: 250 ГБ

-   ЦП: 2

-   ОЗУ: 4 ГБ

-   Параметры брандмауэра:

    -   Разрешить сборщику журналируемых данных получать входящий трафик FTP и Syslog.

    -   Разрешить сборщику журналируемых данных инициировать передачу исходящего трафика на портал (например, contoso.cloudappsecurity.com) через порт 443.

## <a name="log-collector-performance"></a>Производительность сборщика журналируемых данных

Сборщик журналируемых данных может успешно обрабатывать до 50 ГБ журналов в час. Основными узкими местами в процессе сбора журналов являются:

-   Пропускная способность сети — определяет скорость отправки журналов.

-   Производительность ввода-вывода виртуальной машины, назначенная ИТ-специалистом, — определяет скорость записи журналов на диск сборщика. Сборщик журналируемых данных снабжен встроенным защитным механизмом, который контролирует скорость поступления журналов и сравнивает ее со скоростью передачи. В случае перегрузки сборщик начинает удалять файлы журнала. Если ваша нагрузка обычно превышает 50 ГБ в час, рекомендуется разделить трафик между несколькими сборщиками журналируемых данных.

## <a name="step-1--web-portal-configuration-define-data-sources-and-link-them-to-a-log-collector"></a>Шаг 1. Конфигурация веб-портала: определение источников данных и связывание их со сборщиком журналируемых данных

1.  Перейдите на страницу настройки автоматической отправки:  <br></br>На портале Cloud App Security щелкните значок "Настройки" ![значок "Настройки"](./media/settings-icon.png), после чего выберите **Сборщики данных журнала**.

2.  Для каждого брандмауэра или прокси-сервера, с которого вы хотите отправить журналы, создайте соответствующий источник данных:

    ![ubuntu1](./media/ubuntu1.png)

    а. Щелкните **Добавление источника данных**.

    b. Присвойте **Имя** прокси-серверу или брандмауэру.

    c. Выберите устройство в списке **Источник**.

    d. Сравните журнал с примером ожидаемого формата журнала. Если формат вашего файла журнала не соответствует этому примеру, необходимо добавить источник данных с параметром **Другой**.

    д. Задайте для параметра **Тип приемника** одно из следующих значений: **FTP**, **FTPS**, **Syslog — UDP**, **Syslog — TCP** или **Syslog — TLS**.
    >[!NOTE]
    >Для интеграции с протоколами безопасной передачи (FTPS и Syslog — TLS) часто требуются дополнительные параметры либо брандмауэр или прокси-сервер.

    е. Повторите эту процедуру для каждого брандмауэра и прокси-сервера, журналы которых можно использовать для обнаружения трафика в сети.

3.  Перейдите на расположенную сверху вкладку **Сборщики данных журнала**.

    a. Щелкните **Добавить сборщик данных журнала**.

    b. Присвойте **имя** сборщику журналируемых данных.

    в. Введите значение **IP-адреса узла** компьютера, который будет использоваться для развертывания Docker.

    г. Выберите все **источники данных**, которые необходимо подключить к сборщику, и щелкните **Обновить**, чтобы сохранить конфигурацию. См. следующие шаги по развертыванию.

    ![ubuntu2](./media/ubuntu2.png)

    >  [!NOTE]
    > - Отдельный сборщик журналируемых данных может обрабатывать несколько источников данных.
    >- Скопируйте содержимое экрана, так как эта информация потребуется при настройке взаимодействия сборщика журналируемых данных с Cloud App Security. Если вы выбрали системный журнал, эта информация будет включать сведения о порте, на котором будет работать прослушиватель системного журнала.

4.  Появятся дальнейшие сведения о развертывании.

 ![ubuntu3](./media/ubuntu3.png)

5.  **Скопируйте** команду выполнения из диалогового окна. Вы можете использовать значок "Копировать в буфер" ![значок "Копировать в буфер"](./media/copy-icon.png).

6.  **Экспортируйте** ожидаемую конфигурацию источника данных. Эта конфигурация описывает, как необходимо задать экспорт журналов в ваших устройствах.

  ![ubuntu4](./media/ubuntu4.png)

## <a name="step-2--on-premises-deployment-of-your-machine"></a>Шаг 2. Локальное развертывание компьютера

> [!Note]
> Ниже описывается развертывание в Ubuntu. Этапы развертывания на других платформах немного отличаются.

1.  Откройте терминал на компьютере с Ubuntu.

2.  Перейдите на права привилегированного пользователя с помощью следующей команды: `Sudo - i`.

3.  Удалите старые версии и установите Docker CE, выполнив следующую команду:

    `curl -o /tmp/MCASInstallDocker.sh
    https://adaprodconsole.blob.core.windows.net/public-files/MCASInstallDocker.sh
    && chmod +x /tmp/MCASInstallDocker.sh; sudo /tmp/MCASInstallDocker.sh`

    ![ubuntu5](./media/ubuntu5.png)

4.  Разверните образ сборщика с помощью команды выполнения, созданной на портале.

    ![ubuntu6](./media/ubuntu6.png)

    >[!NOTE]
    >Если необходимо настроить прокси-сервер, добавьте ниже его IP-адрес и порт. Например, если прокси-сервер имеет данные 192.168.10.1:8080, обновленная команда выполнения имеет вид:<br></br>
     `Sudo docker run --name casCollector -p 21:21 -p 20000-20099:20000-20099 -e
    "PUBLICIP='192.168.1.1'" -e "PROXY=192.168.10.1:8080" -e
    "TOKEN=41f8f442c9a30519a058dd3bb9a19c79eb67f34a8816270dc4a384493988863a" -e
    "CONSOLE=tenant2.eu1-rs.adallom.com" -e "COLLECTOR=casCollector" --security-opt
    apparmor:unconfined --cap-add=SYS_ADMIN -dt microsoft/caslogcollector starter`

    ![ubuntu7](./media/ubuntu7.png)

5.  Проверьте, правильно ли работает сборщик, выполнив следующую команду: `Docker logs \<collector_name\>`

Вы увидите сообщение **Успешно завершено.**

  ![ubuntu8](./media/ubuntu8.png)

## <a name="step-4---on-premises-configuration-of-your-network-appliances"></a>Шаг 4. Локальная конфигурация сетевых устройств

Настройте сетевые брандмауэры и прокси-серверы для периодического экспорта журналов на выделенный порт Syslog FTP-каталога согласно указаниям в диалоговом окне, например:

    BlueCoat_HQ - Destination path: \<<machine_name>>\BlueCoat_HQ\

## <a name="step-5---verify-the-successful-deployment-in-the-cloud-app-security-portal"></a>Шаг 5. Проверка успешного развертывания на портале Cloud App Security

Проверьте состояние сборщика в таблице **Сборщик журналов** и убедитесь, что оно имеет значение **Подключен**. Если установлено значение **Создан**, возможно, что подключение и анализ сборщика не завершены.

 ![ubuntu9](./media/ubuntu9.png)

Чтобы убедиться, что журналы периодически отправляются на портал, вы также можете воспользоваться **журналом управления**.

Если возникли проблемы во время развертывания, см. статью [Устранение неполадок с Cloud Discovery](troubleshooting-cloud-discovery.md).

## <a name="see-also"></a>См. также
[Работа с данными Cloud Discovery](working-with-cloud-discovery-data.md)  
[Для получения технической поддержки посетите страницу службы технической поддержки Cloud App Security](http://support.microsoft.com/oas/default.aspx?prid=16031).  
[Клиенты с поддержкой Premier могут также выбрать Cloud App Security непосредственно на портале Premier](https://premier.microsoft.com/).

