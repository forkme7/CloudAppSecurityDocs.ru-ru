---
title: "Настройка автоматической отправки журналов для непрерывных отчетов | Документы Майкрософт"
description: "Из этой статьи вы узнаете, как настроить автоматическую отправку журналов для непрерывных отчетов в Cloud App Security с помощью Docker в Ubuntu."
keywords: 
author: rkarlin
ms.author: rkarlin
manager: mbaldwin
ms.date: 8/6/2017
ms.topic: get-started-article
ms.prod: 
ms.service: cloud-app-security
ms.technology: 
ms.assetid: cc29a6cb-1c03-4148-8afd-3ad47003a1e3
ms.reviewer: reutam
ms.suite: ems
ms.openlocfilehash: 7fe91dbeba5b899ca7e19a2b8bf3458fa36f52fe
ms.sourcegitcommit: f9851779aa15b11f559e56ac818f1333f027c000
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="set-up-and-configuration-on-ubuntu"></a>Установка и настройка в Ubuntu

> [!NOTE]
> Этот компонент выпускается для клиентов постепенно. Если вы хотите получить доступ к предварительной версии, обратитесь в службу поддержки.

## <a name="technical-requirements"></a>Технические требования

-   ОС: Ubuntu 14.04 или более поздней версии

-   Место на диске: 250 ГБ

-   ЦП: 2

-   ОЗУ: 4 ГБ

-   Параметры брандмауэра:

    -   Разрешите сборщику журналируемых данных получать входящий трафик FTP и Syslog.

    -   Разрешите сборщику журналируемых данных инициировать передачу исходящего трафика на портал (например, contoso.cloudappsecurity.com) через порт 443.

## <a name="log-collector-performance"></a>Производительность сборщика журналируемых данных

Сборщик журналируемых данных может успешно обрабатывать до 50 ГБ журналов в час. Основными узкими местами в процессе сбора журналов являются:

-   Пропускная способность сети — определяет скорость отправки журналов.

-   Производительность ввода-вывода виртуальной машины, назначенная ИТ-специалистом, — определяет скорость записи журналов на диск сборщика. Сборщик журналируемых данных снабжен встроенным защитным механизмом, который контролирует скорость поступления журналов и сравнивает ее со скоростью передачи. В случае перегрузки сборщик начинает удалять файлы журнала. Если нагрузка обычно превышает 50 ГБ в час, рекомендуется разделить трафик между несколькими сборщиками журналируемых данных.

## <a name="set-up-and-configuration"></a>Настройка и конфигурация  

### <a name="step-1--web-portal-configuration-define-data-sources-and-link-them-to-a-log-collector"></a>Шаг 1. Конфигурация веб-портала: определение источников данных и связывание их со сборщиком журналируемых данных

1.  Перейдите на страницу настройки автоматической отправки:  <br></br>На портале Cloud App Security щелкните значок настроек ![значок настроек](./media/settings-icon.png), а затем выберите пункт **Сборщики данных журнала**.

2.  Для каждого брандмауэра или прокси-сервера, с которого вы хотите отправить журналы, создайте соответствующий источник данных:

    ![ubuntu1](./media/ubuntu1.png)

    a. Щелкните **Добавление источника данных**.

    b. Присвойте **Имя** прокси-серверу или брандмауэру.

    c. Выберите устройство в списке **Источник**. Если вы выбрали **пользовательский формат журнала** для работы с сетевым устройством, которое не указано в списке, см. инструкции по настройке из статьи [Использование настраиваемого средства синтаксического анализа журналов](custom-log-parser.md).

    d. Сравните журнал с примером ожидаемого формата журнала. Если формат вашего файла журнала не соответствует этому примеру, необходимо добавить источник данных с параметром **Другой**.

    e. Задайте для параметра **Тип приемника** значение **FTP**, **FTPS**, **Syslog — UDP**, **Syslog — TCP** или **Syslog — TLS**.
    >[!NOTE]
    >Для интеграции с протоколами безопасной передачи (FTPS и Syslog — TLS) часто требуются дополнительные параметры, брандмауэр или прокси-сервер.

    f. Повторите эту процедуру для каждого брандмауэра и прокси-сервера, журналы которых можно использовать для обнаружения трафика в сети.

3.  Перейдите на расположенную сверху вкладку **Сборщики данных журнала**.

    a. Щелкните **Добавить сборщик данных журнала**.

    b. Присвойте **имя** сборщику журналируемых данных.

    c. Введите **IP-адрес узла** компьютера, который будет использоваться для развертывания Docker.

    d. Выберите все **источники данных**, которые необходимо подключить к сборщику, и нажмите кнопку **Обновить**, чтобы сохранить конфигурацию (см. следующие шаги по развертыванию).

    ![ubuntu2](./media/ubuntu2.png)

    >  [!NOTE]
    > - Отдельный сборщик журналируемых данных может обрабатывать несколько источников данных.
    >- Скопируйте содержимое экрана, так как эта информация потребуется при настройке взаимодействия сборщика журналируемых данных с Cloud App Security. Если вы выбрали системный журнал, эта информация будет включать сведения о порте, на котором будет работать прослушиватель системного журнала.

4.  Отобразятся дополнительные сведения о развертывании.

 ![ubuntu3](./media/ubuntu3.png)

5.  **Скопируйте** команду выполнения из диалогового окна. Вы можете использовать значок копирования в буфер обмена ![значок копирования в буфер обмена](./media/copy-icon.png).

6.  **Экспортируйте** ожидаемую конфигурацию источника данных. В этой конфигурации описано, как необходимо настроить экспорт журналов на устройствах.

  ![ubuntu4](./media/ubuntu4.png)

### <a name="step-2--on-premises-deployment-of-your-machine"></a>Шаг 2. Локальное развертывание виртуальной машины

> [!Note]
> Ниже описывается развертывание в Ubuntu. Действия по развертыванию на других платформах немного отличаются.

1.  Откройте окно терминала на компьютере c Ubuntu.

2.  Переключитесь на права привилегированного пользователя с помощью команды `sudo - i`.

3.  Удалите старые версии и установите Docker CE, выполнив следующую команду:

    `curl -o /tmp/MCASInstallDocker.sh
    https://adaprodconsole.blob.core.windows.net/public-files/MCASInstallDocker.sh
    && chmod +x /tmp/MCASInstallDocker.sh; sudo /tmp/MCASInstallDocker.sh`

    ![ubuntu5](./media/ubuntu5.png)

4.  Разверните образ сборщика с помощью команды выполнения, созданной на портале.

    ![ubuntu6](./media/ubuntu6.png)

    >[!NOTE]
    >Если необходимо настроить прокси-сервер, добавьте его IP-адрес и порт, как показано ниже. Например, если данные прокси-сервера — 192.168.10.1:8080, измененная команда выполнения будет выглядеть так:<br></br>
     `sudo docker run --name MyLogCollector -p 21:21 -p 20000-20099:20000-20099 -e
    "PUBLICIP='192.168.1.1'" -e "PROXY=192.168.10.1:8080" -e
    "TOKEN=41f8f442c9a30519a058dd3bb9a19c79eb67f34a8816270dc4a384493988863a" -e
    "CONSOLE=tenant2.eu1-rs.adallom.com" -e "COLLECTOR=MyLogCollector" --security-opt
    apparmor:unconfined --cap-add=SYS_ADMIN -dt microsoft/caslogcollector starter`

    ![ubuntu7](./media/ubuntu7.png)

5.  Убедитесь, что сборщик работает без ошибок, выполнив следующую команду: `docker logs \<collector_name\>`

Должно отобразиться сообщение **Завершено успешно**.

  ![ubuntu8](./media/ubuntu8.png)

### <a name="step-3---on-premises-configuration-of-your-network-appliances"></a>Шаг 3. Локальная конфигурация сетевых устройств

Настройте сетевые брандмауэры и прокси-серверы для периодического экспорта журналов на выделенный порт Syslog FTP-каталога согласно указаниям в диалоговом окне, например:

    BlueCoat_HQ - Destination path: \<<machine_name>>\BlueCoat_HQ\

### <a name="step-4---verify-the-successful-deployment-in-the-cloud-app-security-portal"></a>Шаг 4. Проверка успешного развертывания на портале Cloud App Security

Проверьте состояние сборщика в таблице **Сборщик журналов** и убедитесь, что оно имеет значение **Подключен**. Если установлено значение **Создан**, возможно, что подключение и анализ сборщика не завершены.

 ![ubuntu9](./media/ubuntu9.png)

Вы также можете убедиться, что журналы периодически отправляются на портал, воспользовавшись **журналом управления**.

Если возникли проблемы во время развертывания, см. статью [Устранение неполадок с Cloud Discovery](troubleshooting-cloud-discovery.md).

### <a name="optional---create-custom-continuous-reports"></a>Дополнительно — создание настраиваемых непрерывных отчетов

Убедившись, что журналы отправляются в Cloud App Security и создаются отчеты, вы можете создать настраиваемые отчеты. Вы можете создавать настраиваемые отчеты об обнаружении на основе групп пользователей Azure Active Directory. Например, если нужно просмотреть сведения об использовании облачных приложений отделом маркетинга, можно импортировать соответствующую группу с помощью функции импорта группы пользователей, а затем создать для нее пользовательский отчет. Можно также настроить отчет на основе тега IP-адреса или диапазонов IP-адресов.

1. На портале Cloud App Security щелкните значок шестеренки "Параметры", выберите **Параметры Cloud Discovery** и затем **Управление непрерывными отчетами**. 
2. Нажмите кнопку **Создать отчет** и заполните поля.
3. В разделе **Фильтры** можно выполнить фильтрацию по источнику данных, [импортированной группе пользователей](user-groups.md) либо [тегам и диапазонам IP-адресов](ip-tags.md). 

![Настраиваемый непрерывный отчет](./media/custom-continuous-report.png)

## <a name="see-also"></a>См. также
[Работа с данными Cloud Discovery](working-with-cloud-discovery-data.md)  
[Чтобы получить техническую поддержку, перейдите на страницу службы технической поддержки Cloud App Security.](http://support.microsoft.com/oas/default.aspx?prid=16031)  
[Клиенты с поддержкой Premier также могут выбрать Cloud App Security непосредственно на портале Premier.](https://premier.microsoft.com/)

